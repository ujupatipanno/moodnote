# 커서 이동 vs 포커스: 둘 다 필요한가?

## 현재 구현 분석

현재 `openOrCreateMonthlyNoteAndJumpToToday()` 메서드는 다음 순서로 동작합니다:

1. **파일 열기**: 월별 노트 파일을 열거나 생성
2. **오늘 섹션 확인/생성**: 오늘 날짜 헤더가 없으면 추가
3. **커서 이동**: 오늘 섹션의 적절한 위치로 커서 이동 (130-154줄)
4. **포커스**: `editor.focus()` 호출 (156줄)

---

## 핵심 질문: 커서 이동과 포커스, 둘 다 필요한가?

### 옵션 1: 커서 이동만 (포커스 제거)
```typescript
editor.setCursor({ line: targetLine, ch: targetCh });
// editor.focus(); ← 제거
```

**장점:**
- 코드가 더 간단함
- 일부 환경에서는 커서 이동만으로도 자동 포커스될 수 있음

**단점:**
- 데스크톱: 파일이 열려도 에디터가 활성화되지 않을 수 있음
- 사용자가 다른 패널(사이드바, 검색창 등)에 있었다면 에디터로 포커스가 돌아오지 않음
- **모바일: 키보드가 자동으로 뜨지 않음** (원래 문제)

**결론:** 불충분함

---

### 옵션 2: 포커스만 (커서 이동 제거)
```typescript
// editor.setCursor({ line: targetLine, ch: targetCh }); ← 제거
editor.focus();
```

**장점:**
- 에디터에 포커스는 확실히 줌
- 모바일 키보드가 뜰 가능성이 높아짐

**단점:**
- **커서 위치가 이전 상태 그대로 유지됨**
- 사용자가 오늘 섹션에서 입력을 시작하려면 수동으로 스크롤하고 커서를 이동해야 함
- 플러그인의 핵심 기능("오늘 섹션으로 빠르게 이동")이 상실됨

**결론:** 기능 요구사항 미충족

---

### 옵션 3: 포커스만 + 스크롤 (커서는 이동 안 함)
```typescript
// 스크롤만 조정 (Obsidian API에서 가능한지 확인 필요)
editor.scrollIntoView({ line: targetLine, ch: targetCh });
editor.focus();
```

**장점:**
- 화면상으로 오늘 섹션이 보임
- 에디터에 포커스도 줌

**단점:**
- 커서는 여전히 원래 위치에 있음
- 사용자가 타이핑을 시작하면 엉뚱한 곳에 입력됨
- UX가 매우 혼란스러움

**결론:** 나쁜 사용자 경험

---

### 옵션 4: 커서 이동 + 포커스 (현재 구현)
```typescript
editor.setCursor({ line: targetLine, ch: targetCh });
editor.focus();
```

**장점:**
- **커서가 정확한 위치(오늘 섹션)로 이동**
- **에디터에 명시적으로 포커스**
- 사용자가 즉시 타이핑 시작 가능
- 데스크톱과 모바일 모두 고려한 구현

**단점:**
- 코드가 약간 더 김 (하지만 의미 있는 복잡도)

**결론:** 가장 완전한 구현

---

## 상세 분석

### 커서 이동의 역할
1. **위치 지정**: 사용자가 타이핑을 시작할 정확한 위치 설정
2. **스크롤 자동 조정**: Obsidian은 커서 위치로 자동 스크롤
3. **의도 명확화**: "여기서 입력하세요"라는 명확한 신호

### 포커스의 역할
1. **에디터 활성화**: 다른 UI 요소에서 에디터로 제어권 이동
2. **키보드 이벤트 수신 준비**: 키 입력을 받을 수 있는 상태로 만듦
3. **모바일 키보드 트리거**: (이론상) 가상 키보드를 띄움

### 둘의 관계
- **독립적인 기능**: 커서 이동과 포커스는 서로 다른 목적을 가진 독립적인 작업
- **상호보완적**: 커서 이동은 "어디에" 입력할지, 포커스는 "지금 바로" 입력할 수 있게 함
- **순서 중요**: 커서를 먼저 이동한 후 포커스를 주는 것이 자연스러운 흐름

---

## 실제 시나리오별 동작 예측

### 시나리오 1: 사이드바에서 플러그인 실행
- **커서 이동만**: 노트가 열리고 커서는 이동하지만, 사이드바에 포커스 유지 → 타이핑 안 됨
- **포커스만**: 에디터에 포커스되지만 커서는 문서 처음이나 이전 위치 → 스크롤 필요
- **둘 다**: 노트가 열리고, 오늘 섹션으로 커서 이동, 에디터 활성화 → 즉시 타이핑 가능 ✓

### 시나리오 2: 다른 노트를 보다가 실행
- **커서 이동만**: 월별 노트로 전환, 커서 이동, 하지만 포커스는 불확실 → 50% 성공
- **포커스만**: 월별 노트로 전환, 에디터 포커스, 커서는 문서 처음 → 수동 이동 필요
- **둘 다**: 월별 노트로 전환, 오늘 섹션으로 이동, 에디터 활성화 → 완벽 ✓

### 시나리오 3: 모바일에서 실행
- **커서 이동만**: 커서는 이동하지만 키보드 안 뜸 → 화면 터치 필요
- **포커스만**: 키보드는 뜰 수 있지만 커서 위치 잘못됨 → 혼란
- **둘 다**: 커서 정확한 위치 + 키보드 뜰 가능성 최대화 ✓

---

## 추가 고려사항

### CodeMirror 6의 동작 특성
Obsidian은 CodeMirror 6를 사용합니다:
- `setCursor()`: 커서 위치만 변경, 포커스 보장 안 함
- `focus()`: DOM 요소에 포커스, 커서 위치 변경 안 함
- 두 메서드는 완전히 독립적

### 다른 Obsidian 플러그인 참고
대부분의 Obsidian 플러그인은:
- 파일을 열고
- 특정 위치로 이동하고
- 명시적으로 포커스를 줌

예: Periodic Notes, Daily Notes 플러그인들이 유사한 패턴 사용

---

## 최종 결론

### 답변: 둘 다 필요합니다

**이유:**
1. **기능 완성도**: 커서 이동 없이는 "오늘 섹션으로 점프" 기능이 동작하지 않음
2. **UX 완성도**: 포커스 없이는 사용자가 추가 클릭 필요
3. **독립성**: 두 기능은 서로 다른 문제를 해결함
4. **모바일 대응**: 포커스가 모바일 키보드 트리거의 첫 단계

### 현재 구현 평가
✅ **현재 구현(커서 이동 + 포커스)이 정답**

### 개선 여지
만약 더 개선하려면:
```typescript
editor.setCursor({ line: targetLine, ch: targetCh });
editor.focus();

// 모바일에서 추가로 시도할 수 있는 옵션들:
if (this.app.isMobile) {
    // 방안 6: DOM 직접 포커스
    const editorElement = view.contentEl.querySelector('.cm-content');
    if (editorElement) {
        editorElement.focus();
    }
}
```

---

## 요약

| 구현 방식 | 커서 위치 | 에디터 포커스 | UX 평가 |
|---------|---------|------------|---------|
| 커서만 | ✓ 정확 | ✗ 불확실 | 미흡 |
| 포커스만 | ✗ 잘못됨 | ✓ 확실 | 나쁨 |
| **둘 다** | **✓ 정확** | **✓ 확실** | **최상** |

**결론: 커서 이동과 포커스는 각각 다른 목적을 가진 필수 기능이므로 둘 다 유지해야 합니다.**
