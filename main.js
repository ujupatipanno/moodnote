"use strict";var v=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var N=(s,o)=>{for(var t in o)v(s,t,{get:o[t],enumerable:!0})},A=(s,o,t,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of k(o))!L.call(s,n)&&n!==t&&v(s,n,{get:()=>o[n],enumerable:!(e=b(o,n))||e.enumerable});return s};var E=s=>A(v({},"__esModule",{value:!0}),s);var H={};N(H,{default:()=>u});module.exports=E(H);var i=require("obsidian"),T={folderPath:"moodnote/"},u=class extends i.Plugin{constructor(){super(...arguments);this.settings=T}async onload(){await this.loadSettings(),this.addRibbonIcon("calendar","\uAC10\uC815\uB178\uD2B8 \uC5F4\uAE30",async()=>{try{await this.openOrCreateMonthlyNoteAndJumpToToday()}catch(t){console.error(t),new i.Notice("\uAC10\uC815\uB178\uD2B8 \uC5F4\uAE30 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4")}}),this.addCommand({id:"moodnote-open-or-create-current-month",name:"\uAC10\uC815\uB178\uD2B8 \uC5F4\uAE30",icon:"calendar",callback:async()=>{try{await this.openOrCreateMonthlyNoteAndJumpToToday()}catch(t){console.error(t),new i.Notice("\uAC10\uC815\uB178\uD2B8 \uC5F4\uAE30 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4")}}}),this.addSettingTab(new S(this.app,this))}async onunload(){}getCurrentMonthFileName(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${e}-${n}`}getTodayHeader(){let t=new Date,e=String(t.getDate()).padStart(2,"0"),n=t.toLocaleDateString("ko-KR",{weekday:"short"});return`### ${e}\uC77C (${n})`}getTodayHeaderRegex(){let e=String(new Date().getDate()).padStart(2,"0");return new RegExp(`^###\\s+${e}\uC77C\\s+\\([^)]+\\)`,"m")}async ensureFolder(t){let e=t.replace(/\\\\/g,"/");if(!e||e==="/")return;let l=this.app.vault.adapter,c=e.split("/").filter(Boolean),d="";for(let a of c)d=d?`${d}/${a}`:a,await l.exists(d)||await l.mkdir(d)}async openOrCreateMonthlyNoteAndJumpToToday(){let t=this.settings.folderPath?.trim()||T.folderPath,e=this.getCurrentMonthFileName(),n=t.endsWith("/")?`${t}${e}.md`:`${t}/${e}.md`;await this.ensureFolder(t);let l=this.app.vault.getAbstractFileByPath(n);l||(l=await this.app.vault.create(n,""));let c=this.app.workspace.getLeaf(!1);c&&(await c.openFile(l),this.app.workspace.setActiveLeaf(c));let a=c?.view?.editor;if(!a)return;let x=a.getValue(),P=this.getTodayHeader(),M=this.getTodayHeaderRegex(),h=x;M.test(x)||(h.length>0&&!h.endsWith(`
`)&&(h+=`
`),h+=`${P}
`,a.setValue(h),await this.app.vault.modify(l,h));let f=a.getValue(),C=f.indexOf(P);if(a.focus(),C>=0){let y=f.slice(0,C).split(`
`).length-1,g=f.split(`
`),p=y+1,m=-1;for(;p<g.length;p++)if(g[p].startsWith("### ")){m=p;break}let $=m===-1?g.length-1:m-1,w=Math.min(y+1,a.lineCount()-1);for(let r=$;r>=y+1;r--)if(g[r].trim().length>0){w=r;break}let F=g[w]?.length??0;if(a.setCursor({line:w,ch:F}),a.cm?.scrollDOM){let r=a.cm.scrollDOM;r.scrollTop=r.scrollHeight-r.clientHeight}}else{let D=a.lineCount()-1;a.setCursor({line:D,ch:0})}}async loadSettings(){this.settings=Object.assign({},T,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},S=class extends i.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"moodnote \uC124\uC815"}),new i.Setting(t).setName("\uD3F4\uB354 \uACBD\uB85C").setDesc("\uC6D4\uBCC4 \uB178\uD2B8\uB97C \uC800\uC7A5\uD560 \uD3F4\uB354 (\uC608: moodnote/)").addText(e=>{e.setPlaceholder("moodnote/").setValue(this.plugin.settings.folderPath).onChange(async n=>{this.plugin.settings.folderPath=n,await this.plugin.saveSettings()})})}};
