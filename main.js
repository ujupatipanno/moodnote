"use strict";var v=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var N=(s,a)=>{for(var t in a)v(s,t,{get:a[t],enumerable:!0})},A=(s,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of k(a))!L.call(s,n)&&n!==t&&v(s,n,{get:()=>a[n],enumerable:!(e=M(a,n))||e.enumerable});return s};var E=s=>A(v({},"__esModule",{value:!0}),s);var R={};N(R,{default:()=>u});module.exports=E(R);var i=require("obsidian"),T={folderPath:"moodnote/"},u=class extends i.Plugin{constructor(){super(...arguments);this.settings=T}async onload(){await this.loadSettings(),this.addRibbonIcon("calendar","\uC624\uB298 moodnote \uC5F4\uAE30",async()=>{try{await this.openOrCreateMonthlyNoteAndJumpToToday()}catch(t){console.error(t),new i.Notice("moodnote \uC2E4\uD589 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4")}}),this.addCommand({id:"moodnote-open-or-create-current-month",name:"\uC624\uB298 moodnote \uC5F4\uAE30",icon:"calendar",callback:async()=>{try{await this.openOrCreateMonthlyNoteAndJumpToToday()}catch(t){console.error(t),new i.Notice("moodnote \uC2E4\uD589 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4")}}}),this.addSettingTab(new S(this.app,this))}async onunload(){}getCurrentMonthFileName(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${e}-${n}`}getTodayHeader(){let t=new Date,e=String(t.getDate()).padStart(2,"0"),n=t.toLocaleDateString("ko-KR",{weekday:"short"});return`### ${e}\uC77C (${n})`}getTodayHeaderRegex(){let e=String(new Date().getDate()).padStart(2,"0");return new RegExp(`^###\\s+${e}\uC77C\\s+\\([^)]+\\)`,"m")}async ensureFolder(t){let e=t.replace(/\\\\/g,"/");if(!e||e==="/")return;let r=this.app.vault.adapter,l=e.split("/").filter(Boolean),d="";for(let o of l)d=d?`${d}/${o}`:o,await r.exists(d)||await r.mkdir(d)}async openOrCreateMonthlyNoteAndJumpToToday(){let t=this.settings.folderPath?.trim()||T.folderPath,e=this.getCurrentMonthFileName(),n=t.endsWith("/")?`${t}${e}.md`:`${t}/${e}.md`;await this.ensureFolder(t);let r=this.app.vault.getAbstractFileByPath(n);r||(r=await this.app.vault.create(n,""));let l=this.app.workspace.getLeaf(!1);l&&(await l.openFile(r),this.app.workspace.setActiveLeaf(l));let o=l?.view?.editor;if(!o)return;let x=o.getValue(),P=this.getTodayHeader(),F=this.getTodayHeaderRegex(),c=x;F.test(x)||(c.length>0&&!c.endsWith(`
`)&&(c+=`
`),c+=`${P}
`,o.setValue(c),await this.app.vault.modify(r,c));let f=o.getValue(),C=f.indexOf(P);if(C>=0){let m=f.slice(0,C).split(`
`).length-1,h=f.split(`
`),g=m+1,y=-1;for(;g<h.length;g++)if(h[g].startsWith("### ")){y=g;break}let b=y===-1?h.length-1:y-1,w=Math.min(m+1,o.lineCount()-1);for(let p=b;p>=m+1;p--)if(h[p].trim().length>0){w=p;break}let D=h[w]?.length??0;o.setCursor({line:w,ch:D})}else{let $=o.lineCount()-1;o.setCursor({line:$,ch:0})}}async loadSettings(){this.settings=Object.assign({},T,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},S=class extends i.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"moodnote \uC124\uC815"}),new i.Setting(t).setName("\uD3F4\uB354 \uACBD\uB85C").setDesc("\uC6D4\uBCC4 \uB178\uD2B8\uB97C \uC800\uC7A5\uD560 \uD3F4\uB354 (\uC608: moodnote/)").addText(e=>{e.setPlaceholder("moodnote/").setValue(this.plugin.settings.folderPath).onChange(async n=>{this.plugin.settings.folderPath=n,await this.plugin.saveSettings()})})}};
