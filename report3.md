# 코드 최적화 평가 (src/main.ts)

## 종합 평가
- 최적화 수준: 4/5 — 간결하고 목적에 맞는 흐름, 불필요한 연산 적음.
- 복잡도 관리: 4/5 — 기능이 분리되어 있고 가독성이 양호.
- 성능 적합성: 4/5 — 현재 규모(MVP)에서 O(n) 텍스트 스캔은 충분히 합리적.

## 강점
- **단순한 데이터 흐름**: 월 파일 경로 계산 → 폴더 보장 → 파일 열기/생성 → 헤더 유무 판정 → 삽입/커서 이동.
- **API 사용 합리적**: `workspace.getLeaf(false)`로 활성 패널 재사용, `vault.modify`로 저장.
- **불필요 I/O 최소화**: 존재 판정 후에만 생성, 필요 시에만 수정.
- **로직 분리**: 날짜/정규식/폴더 보장은 별도 메서드로 추출되어 재사용성과 테스트 용이.

## 개선 여지
1. **정규식 기반 위치 지정**
   - 현재 위치 계산은 `indexOf(todayHeader)` 문자열 일치에 의존. 공백/이모지/스타일 변화에 취약.
   - 제안: `headerRegex.exec(fullText)`의 `index`를 사용해 헤더 시작 위치를 가져오면 포맷 변형에도 견고.

2. **다음 헤더 탐지 고도화**
   - 현재는 `lines[i].startsWith("### ")`로 다음 섹션을 탐지. 비일관 포맷(공백, 인라인 아이콘 등)에서 오검 가능.
   - 제안: `^###\s+\d{2}\s+\([^)]+\)` (멀티라인)로 정확히 일자 헤더만 탐지.

3. **에디터 비동기 안전성**
   - 파일 열기 직후 `leaf.view.editor`가 생성되기 전인 경우가 드물게 있을 수 있음.
   - 제안: 에디터 준비 대기(폴링 또는 `onLayoutReady` 같은 워크스페이스 이벤트)로 견고성 향상.

4. **폴더 생성 최적화**
   - `ensureFolder`는 경로 단계별 `exists`→`mkdir`의 연속 I/O.
   - 제안: 어댑터가 제공하는 상위 디렉토리 존재 시 전체 경로 `mkdir` 시도 후 실패 시 단계별 생성(최적화는 미미하지만 코드 축약 가능).

5. **설정 확장성(세부)**
    - 미사용 설정 필드: `headerFormat: "iso" | "kr"`가 `getTodayHeader()` 및 `getTodayHeaderRegex()`에 반영되지 않아 사실상 죽은 설정입니다.
    - 잠재 불일치: 설정 탭에는 `folderPath`만 노출되고, `headerFormat`은 UI가 없어 사용자가 변경할 수 없으며 코드에서도 사용되지 않아 혼란을 줄 수 있습니다.
    - 구현 누락 포인트:
       - `getTodayHeader()`에서 `headerFormat === "iso"`일 때 포맷을 `### YYYY-MM-DD (ddd)` 또는 `### DD (ddd)` 중 선택하도록 분기 필요.
       - `getTodayHeaderRegex()`도 동일하게 포맷별 정규식을 반환하도록 분기 필요.
       - 설정 탭에 `headerFormat` 선택 UI(라디오 버튼 또는 드롭다운)를 제공하고, 저장/로드 로직에 반영.
    - 대안: 현재 요구사항이 `DD (ddd)`로 고정되어 있다면 `headerFormat`을 제거하여 설정 모델을 간소화하고 일관성을 확보.
    - 추가 확장 아이디어:
       - `blankLinesAfterHeader: number`(0/1/2)를 설정으로 노출해 현재 코드의 한 줄 공백을 사용자가 제어 가능.
       - `reusePaneMode: "active" | "existing"`로 파일 열기 정책을 설정에서 선택 가능.

6. **에지 케이스 정리**
   - 빈 파일에서 선행 줄바꿈 회피는 잘 처리됨. 다만 파일 끝이 다중 공백/탭으로 끝나는 경우도 줄바꿈 여부 판단에 포함할지 고려.

## 코드 품질 메모
- 네이밍, 함수 크기, 예외 처리(오류 Notice 유지) 등 일관적.
- 로직이 명령형으로 직관적이며, 불필요한 캐싱/메모이제이션은 피함(문서 크기 가정 상 적절).

## 권장 변경 요약
- 위치 계산을 정규식 기반으로 개선.
- 다음 헤더 탐지를 날짜 헤더 정규식으로 변경.
- 에디터 준비 상태 확인 로직 추가.
- 사용하지 않는 설정 필드 정리 또는 구현.

## 결론
현재 코드는 기능 대비 적절히 최적화되어 있으며, MVP 단계에서 유지보수성/성능 모두 양호합니다. 위 개선을 반영하면 포맷 변형/에디터 준비 타이밍 등에 대한 견고성이 더 높아집니다.
